<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Wiki" />
    <meta name="generator" content="Maverick 1.1" />
    <meta name="template" content="Kepler" />
    <link rel="alternate" type="application/rss+xml" title="热心市民の知识库 &raquo; RSS 2.0" href="/wiki/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="热心市民の知识库 &raquo; ATOM 1.0" href="/wiki/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/assets/kepler-cf5c67fd1e.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/assets/ExSearch/ExSearch-182e5a8868.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.10.0/dist/tocbot.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css">


    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/169240ee77386349a3a011c3c35857c5.json"
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function(){
            if(/Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent)){
                document.body.classList.add('safari')
            }else{
                document.body.classList.remove('safari')
            }
        });
    </script>
    
<title>1-IP路由基础 - 热心市民の知识库</title>
<meta name="author" content="waleslau" />
<meta name="description" content="IPv4地址" />
<meta property="og:title" content="1-IP路由基础 - 热心市民の知识库" />
<meta property="og:description" content="IPv4地址" />
<meta property="og:site_name" content="热心市民の知识库" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/wiki/archives/1_IP%E8%B7%AF%E7%94%B1%E5%9F%BA%E7%A1%80/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2020-03-17T16:44:00+08.00" />
<meta name="twitter:title" content="1-IP路由基础 - 热心市民の知识库" />
<meta name="twitter:description" content="IPv4地址" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />
<link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/waleslau/CDN@master/vue.ico">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144181320-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-144181320-4');
</script>
<!--
<script src="https://cdn.jsdelivr.net/gh/waleslau/live2d-widget@latest/autoload.js"></script>
-->

    </head>
    
    <body class="content">
        <header>
            <div class="container">
                <section>
                    <a href="/wiki/"><img src="https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/cat.jpg">热心市民の知识库</a>
                </section>
                <section>
                    <nav>
                        <ul>
                            
                                <li><a href="https://home.oopsky.top/" target="_blank">HOME</a></li>
                            
                                <li><a href="https://blog.oopsky.top/" target="_blank">部落格</a></li>
                            
                        </ul>
                    </nav>
                </section>
    
                <section>
                    <a hidden class="toggle-toc" target="_self" href="javascript:void(0)" onclick="$(body).toggleClass('toc-open')"><i class="fa fa-align-right"></i></a>
                    <a hidden class="toggle-navbar" target="_self" href="javascript:void(0)" onclick="$(body).toggleClass('navbar-open')"><i class="fa fa-indent"></i></a>
                    <button class="search-form-input"><i class="fa fa-search"></i></button>
                </section>
            </div>
        </header>

        <main>
            <div id="pjax-container" class="container">
                <aside id="navbar" class="no-scrollbar">
                    
                    <section class="sidebar-nav">
                        
                            <div class="None" ><span><a href="/wiki/">主页</a></span></div>
                        
                            <div class="None" ><span><a href="/wiki/archives/">归档</a></span></div>
                        
                            <div class="None" ><span><a href="/wiki/about/">关于</a></span></div>
                        
                    </section>
                    
                    <section>
                        
    <div class=" "><span><a href="/wiki/category/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><button class="toggle_sidebar fa"></button></span><ul><div class=" "><span><a href="/wiki/category/Linux/">Linux</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/wiki/archives/PVE_%E5%88%9B%E5%BB%BA%E4%B8%B2%E8%A1%8C%E7%AB%AF%E5%8F%A3%E6%9D%A5%E6%94%AF%E6%8C%81%E4%BD%BF%E7%94%A8_xterm_js_%E8%BF%9E%E6%8E%A5%E5%88%B0%E8%99%9A%E6%8B%9F%E6%9C%BA/">PVE 创建串行端口来支持使用 xterm.js 连接到虚拟机</a></li><li class=""><a href="/wiki/archives/Debian%E4%B8%AD%E4%B8%BA%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0sudo%E6%9D%83%E9%99%90/">Debian中为用户添加sudo权限</a></li><li class=""><a href="/wiki/archives/%E5%9C%A8Linux%E5%AE%8C%E6%95%B4%E8%BF%81%E7%A7%BB%E7%BD%91%E7%AB%99_%E6%95%B0%E6%8D%AE%E5%BA%93/">在Linux完整迁移网站&数据库</a></li><li class=""><a href="/wiki/archives/Install_the_latest_Python_on_CentOS7/">在 CentOS7 安装最新的Python程序</a></li><li class=""><a href="/wiki/archives/Arch_Linux_Installation_guide/">Arch Linux 安装指南</a></li></ul></div><div class=" "><span><a href="/wiki/category/Windows/">Windows</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/wiki/archives/MSYS2-environment-configuration/">MSYS2环境配置</a></li><li class=""><a href="/wiki/archives/Windows%E5%88%B7%E6%96%B0DNS/">Windows刷新DNS</a></li><li class=""><a href="/wiki/archives/%E6%B7%BB%E5%8A%A0_Windows_Terminal_%E5%88%B0%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95/">添加 Windows Terminal 到右键菜单</a></li></ul></div></ul></div><div class=" "><span><a href="/wiki/category/%E6%97%A5%E5%B8%B8%E6%8A%80%E5%B7%A7/">日常技巧</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/wiki/archives/FFmpeg%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%8F%82%E6%95%B0/">FFmpeg常用命令及参数</a></li><li class=""><a href="/wiki/archives/%E8%A7%A3%E5%86%B3SecuceCRT%E8%BF%9E%E6%8E%A5eNSP%E6%97%B6tab%E9%94%AE%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/">解决SecuceCRT连接eNSP时tab键乱码问题</a></li><li class=""><a href="/wiki/archives/VS_Code_%E4%B8%80%E9%94%AE%E4%B8%BAMarkDown%E6%96%87%E6%A1%A3%E6%B7%BB%E5%8A%A0_Front_matter/">配置 VS Code 一键为MarkDown文档添加 Front-matter</a></li></ul></div><div class=" "><span><a href="/wiki/category/Web/">Web</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/wiki/archives/%E4%BD%BF%E7%94%A8JavaScript%E5%AE%9E%E7%8E%B0%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC/">使用JavaScript实现页面跳转</a></li><li class=""><a href="/wiki/archives/Front-end_basics_1/">前端基础之 HTML/CSS 初接触</a></li></ul></div><div class="open "><span><a href="/wiki/category/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a><button class="toggle_sidebar fa"></button></span><ul><div class="open "><span><a href="/wiki/category/%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/">路由交换学习之路</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/wiki/archives/3-1-%E5%BC%80%E6%94%BE%E5%BC%8F%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88%E5%8D%8F%E8%AE%AE-OSPF/">3.1-开放式最短路径优先协议(OSPF)</a></li><li class=""><a href="/wiki/archives/2-%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF%E5%8D%8F%E8%AE%AE-RIP/">2-路由信息协议(RIP)</a></li><li class="current"><a href="/wiki/archives/1_IP%E8%B7%AF%E7%94%B1%E5%9F%BA%E7%A1%80/">1-IP路由基础</a></li></ul></div><li class=""><a href="/wiki/archives/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88%E7%AE%97%E6%B3%95/">最短路径优先算法</a></li><li class=""><a href="/wiki/archives/STP%E9%85%8D%E7%BD%AE%E8%BE%B9%E7%BC%98%E7%AB%AF%E5%8F%A3%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/">STP配置边缘端口的两种方式</a></li></ul></div><div class=" "><span><a href="/wiki/category/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><button class="toggle_sidebar fa"></button></span><ul><div class=" "><span><a href="/wiki/category/MongoDB/">MongoDB</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/wiki/archives/Quickly_set_up_MongoDB_environment_with_Docker/">使用Docker快速搭建MongoDB环境</a></li></ul></div><div class=" "><span><a href="/wiki/category/MySQL/">MySQL</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/wiki/archives/About_MySQL_management/">MySQL管理</a></li><li class=""><a href="/wiki/archives/MySQL_CURD/">SQL 学习笔记</a></li></ul></div></ul></div><div class=" "><span><a href="/wiki/category/Default/">Default</a><button class="toggle_sidebar fa"></button></span><ul><li class=""><a href="/wiki/archives/typography/">Typography</a></li></ul></div>

                    </section>
                    <section hidden class="sidebar-external-link">
                        
                            <div class="external"><span><a href="https://home.oopsky.top/">HOME</a><button class="go-external"><i class="fa fa-external-link"></i></button></span></div>
                        
                            <div class="external"><span><a href="https://blog.oopsky.top/">部落格</a><button class="go-external"><i class="fa fa-external-link"></i></button></span></div>
                        
                    </section>
                    <section class="maverick">
                        <div><span style="border: 1px solid #d4dadf;"><a href="https://github.com/AlanDecode/Maverick" target="_blank">Maverick & Kepler</a></span></div>
                    </section>
                </aside>
                <div id="content-wrapper">
                    <div id="content">
    <section>
        <h1 class="post-title">1-IP路由基础</h1>
        <p class="post-meta">
            <time>March 17 2020</time>
            <span class="tags">
                
            </span>
        </p>
        <article class="yue"><h2>IPv4地址</h2>
<h3>地址分类</h3>
<p>长度：32位 4 字节</p>
<ul>
<li><p>A类地址：</p>
<p>第一字节的第一位为0，第一字节数值范围0-127，0和127不做为A类地址，故实际可用范围为1-126</p>
<blockquote>
<p>0  保留，ip地址全为0表示本主机，只做源地址使用</p>
<p>127 保留给本地回环地址</p>
</blockquote>
</li>
<li><p>B类地址：</p>
<p>第一字节的前两位为10，数值范围为128-191</p>
</li>
<li><p>C类地址：</p>
<p>第一字节的前三位为110，数值范围为192-233</p>
</li>
</ul>
<h3>主网段及子网划分</h3>
<ul>
<li><p>主网段采用自然掩码，即A类网络中使用8位掩码，B类网络中使用16位掩码，C类网络中使用32位掩码，</p>
<ul>
<li>A类网络（1-126）默认子网掩码：255.0.0.0</li>
<li>B类网络（128-191）默认子网掩码：255.255.0.0</li>
<li>C类网络（192-223）默认子网掩码：255.255.255.0</li>
</ul>
</li>
<li><p>子网划分</p>
<p>把主类网路地址继续划分成更多的子网络地址</p>
<p>子网掩码用来和IP地址进行“与”运算计算出网路地址,子网掩码由连续的1和连续的0组成，1对应IP中的网络位，0对应IP中的主机位</p>
<ul>
<li>子网数目 = <strong>2^x^</strong><ul>
<li>x为掩码扩展位数（网络位 - 默认网络位）</li>
</ul>
</li>
<li>主机数 = <strong>2^y^ - 2</strong><ul>
<li>y为子网掩码中0的个数</li>
</ul>
</li>
</ul>
<p>主机位全为0：子网的网络地址</p>
<p>主机位全为1：子网的广播地址</p>
</li>
</ul>
<h3>IP报文格式</h3>
<blockquote>
<p><a href="https://support.huawei.com/hedex/hdx.do?docid=EDOC1000105967&amp;lang=zh">IP报文格式大全</a></p>
</blockquote>
<p><a href="https://support.huawei.com/hedex/pages/EDOC1000105967AZI0130X/07/EDOC1000105967AZI0130X/07/resources/message/cd_feature_ip_message_format.html?ft=0&amp;fe=10&amp;hib=4.8&amp;id=cd_feature_ip_message_format&amp;text=IP%25E6%258A%25A5%25E6%2596%2587%25E6%25A0%25BC%25E5%25BC%258F&amp;docid=EDOC1000105967">IP报文格式</a></p>
<h2>路由表 (RIB) 与转发表 (FIB)</h2>
<h3>RIB 与 FIB</h3>
<blockquote>
<p>路由表 (Routing Table, Routing Info Base)</p>
<p>转发表 (Forwarding Info Base)</p>
<p><figure><a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/archives/assets/2e634564c8980c5a6ebc4da5209d0764.jpg"><img data-width="512" data-height="384" src="https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/archives/assets/2e634564c8980c5a6ebc4da5209d0764.jpg" alt="img" /></a><figcaption>img</figcaption></figure></p>
<h3>RIB 路由表</h3>
<p>RIB 存储所有的路由信息。它与具体的路由协议无关。所有的路由协议都在这里保存它们的路由。只要路由器上运行的路由协议学到了新路由，就都会放到路由表中。</p>
<p>当目标地址不可达时，对应的路由条目先被标记为 Unreachable，然后就从 RIB 中删除。</p>
<p><strong>注意：RIB 不是用来进行 IP 包转发的，也不会被宣告到网络中。</strong></p>
<p>总之，RIB 中：</p>
<ol>
<li>有所有通过动态路由协议学到了路由条目</li>
<li>有所有的直连网络</li>
<li>有另外配置的路由条目，如静态路由</li>
</ol>
<p>理想状态下，我们应用 RIB 来转发 IP 包。但实际上，路由表中的一些条目，比如静态和 BGP 路由，它们的下一跳并不是一个直连的网络。</p>
<p>为了找到有效的下一跳，路由器必须进行递归查找，找到实际直连出口。</p>
<h3>FIB 转发表</h3>
<p>Forwarding Information Base 转发表 (FIB) 用于判断基于 IP 包的网络前缀，如何进行转发。</p>
<p>对于每一条可达的目标网络前缀，FIB 包含接口标识符和下一跳信息。 FIB 概念上类似于路由表。它维护一份 RIB 表中的转发信息镜像。</p>
<p>当 IP 路由从 RIB 拷贝到 FIB 时，它们的下一跳信息被明确地分析出来，包括下一跳的具体端口，以及如果到下一跳有多条路径时，每条路径的具体端口。</p>
<p>FIB 表中的条目数也是影响路由器性能的重要因素。通常来讲，FIB 条目越多，查找花费的时间越长。但由于基于 ASIC 芯片的转发技术日臻成熟，目前的查找转发几乎能达到线速。</p>
<p>了解路由器 FIB 最大条目数十分重要，但厂商一般不会在产品指标说明中提供 FIB 的大小限制。</p>
<p>路由器构建 FIB 需要一定的时间。它需要先接收路由信息包，建立路由表，选路，建立转发表并把转发表的适当的子集推送到一些线卡上，只减少路由器 CPU 到线卡的压力。</p>
<p>对于特别大的 FIB 整个过程会需要大约几分钟。如 RFC 3222 所提及。</p>
<p>这种 RIB 加 FIB 的结构，使用控制平面的 RIB 和转发平面的 FIB 分离。这种分离使路由器的性能更加有连续性。</p>
<p>因此，以后再衡量路由器或三层交换机时，一定要检查路由表和 FIB 表的大小。
————————————————
原文链接：<a href="https://blog.csdn.net/ginkov/article/details/51803949">https://blog.csdn.net/ginkov/article/details/51803949</a></p>
</blockquote>
<p>FIB表的Flag位含义：</p>
<ul>
<li>G (GateWay 网关路由)：表示下一跳是网关</li>
<li>H (Host 主机路由)</li>
<li>U (Up 可用路由)：表示该路由状态为Up</li>
<li>S (Stastic 静态路由)</li>
<li>D (Dynamic 动态路由)</li>
<li>B (Black Hole 黑洞路由)：表示下一跳是空接口</li>
<li>L (Vlink Route)：表示Vlink类型路由</li>
</ul>
<h3>路径选择</h3>
<h4>选路规则：</h4>
<ol>
<li><p>选择优先级高的路由(Preference，越小越优先)</p>
</li>
<li><p>如果路由具有相同的Preference，则选择协议内部优先级高的路由</p>
</li>
<li><p>如果路由具有相同优先级又属于同一协议，则优选Cost值低的路由，</p>
<p>若Cost相同则有条件形成负载分担，如果形成负载分担的路由条目大于大于系统限定值m，则只选择前m条作为活跃路由</p>
</li>
</ol>
<h4>负载分担</h4>
<p>包括 路由负载分担、隧道负载分担、Eth-Trunk负载分担</p>
<p>优点：</p>
<ul>
<li>将流量分担到多条链路，增加链路总带宽</li>
<li>负载分担的链路之间形成备份关系，提高链路可靠性</li>
</ul>
<p>缺点：</p>
<ul>
<li>流量转发有随机性，负载分担可能不利于业务流量的管理</li>
</ul>
<p>按照对连续数据包的处理方式可分为：</p>
<ul>
<li><p>逐包负载分担</p>
<p>总是选择与上一次不同的下一跳地址发送报文</p>
</li>
<li><p>逐流负载分担</p>
<p>根据IP报文中五元组信息(源地址、目的地址、源端口、目的端口、协议)进行转发，</p>
<p>五元组信息相同的一串报文被称为流</p>
<p>不同流走不通的路径</p>
</li>
</ul>
<h4>负载分担算法</h4>
<blockquote>
<p>逐包分担均衡程度比逐流好，但可能导致报文乱序</p>
</blockquote>
<ol>
<li><p>等成本负载分担</p>
<p>ECMP(Equal-cost multi-path)</p>
<p>等成本负载分担是指到达同一目的地有多条等价链路，流量在这些链路上平均分配，不会考虑链路带宽差异</p>
<blockquote>
<p>等价链路指到达目的地的cost值相同的链路/路径</p>
<p>等价路由指优先级和路由度量值相同的路由</p>
</blockquote>
<p>缺点：路径间带宽差异性大时，带宽利用率低</p>
</li>
<li><p>非等成本负载分担</p>
<p>UCMP(Unequal-cost multi-path)</p>
<p>非成本负载分担是指到达同一目的地有多条带宽不同的等价链路，流量根据带宽按比例分摊到各条链路上平均分配，可提高带宽利用率</p>
</li>
</ol>
<h4>度量</h4>
<blockquote>
<p>路由的度量(metric)表示出了某路由到达指定地址的代价</p>
<p>通常包含以下因素</p>
<ul>
<li>路径长度<ul>
<li>经过的所有链路开销综合</li>
<li>距离矢量路由协议中使用跳数来标示路径长度</li>
</ul>
</li>
<li>网络带宽</li>
<li>负载（资源使用程度）</li>
<li>通信开销（线路运营成本）</li>
</ul>
</blockquote>
<p>RIP协议的 metric 由条数来表示，最大15跳，若为16跳则表示目的网络不可达</p>
<p>OSPF和ISIS等高级路由协议可使用和接口带宽有关系的度量来表示</p>
<h4>下一跳</h4>
<blockquote>
<p>路由表中任何路由都需要直连的下一跳</p>
</blockquote>
<ul>
<li><p>直连下一跳和非直连下一跳</p>
</li>
<li><p>直连下一跳是IGP路由协议中，由直连邻居通告的路由</p>
<ul>
<li><p>非直连下一跳出现在默认路由和BGP场景下</p>
<ul>
<li>RIB表将路由下放到FIB表时，迭代不直连的下一跳为直连的下一跳/接口</li>
<li>FIB表中任何路由都会关联到直连接口&amp;直连下一跳</li>
</ul>
</li>
</ul>
</li>
<li><p>路由指向出口或下一跳</p>
</li>
</ul>
<h2>有类路由和无类路由</h2>
<p>有类路由协议：路由更新时，没有包含掩码相关信息，如RIPv1</p>
<p>无类路由协议：通告的路由中携带子网掩码，如RIPv2、OSPF、IS-IS、BGP</p>
<p><strong>有类查找方式</strong></p>
<p>先匹配主网路由，如果主网路由存在(匹配到了)，再继续查找是否有对应的子网，如果没有匹配的子网，则报文丢弃(不论是否有缺省路由)</p>
<p>若匹配不到主网路由，则走默认路由，若无缺省路由，丢弃</p>
<p><strong>无类查找方式</strong></p>
<p>直接按照掩码”最长匹配“原则进行查找，匹配不上就找缺省路由，还匹配不上就丢弃</p>
<h2>路由协议</h2>
<blockquote>
<p>路由根据来源不同，可分为三类</p>
<ul>
<li>直连路由：通过链路层协议发现的路由</li>
<li>静态路由：管理员手工指定的路由</li>
<li>动态路由：通过动态路由协议发现的路由</li>
</ul>
</blockquote>
<h3>静态路由</h3>
<p>需要注意的：</p>
<ul>
<li>若静态路由协议的下一跳不是直连地址，将会引入迭代过程，增加查表延迟和CPU负荷</li>
<li>可为不同的静态路由配置不同的优先级(preference默认为60，越小越优先)</li>
</ul>
<h3>动态路由</h3>
<h4>动态路由协议分类</h4>
<ol>
<li><p>按照应用范围：</p>
<ul>
<li>IGP：内部网关协议（Interior Gateway Protocol）<ul>
<li>工作在一个自治系统内</li>
<li>例如 RIP、OSPF、ISIS、IBGP</li>
</ul>
</li>
<li>EGP：外部网关协议（Exterior Gateway Protocol）<ul>
<li>工作在不同自治系统之间</li>
<li>例如BGPv4(EBGP)</li>
</ul>
</li>
</ul>
</li>
<li><p>按照类别：</p>
<ul>
<li>有类路由协议</li>
<li>无类路由协议</li>
</ul>
</li>
<li><p>按照算法</p>
<ul>
<li><p>距离矢量协议</p>
<ul>
<li><p>例如 RIP</p>
</li>
<li><p>特点是路由器之间不维持整网的路由信息，只知道到达邻居的路径，</p>
<p>所有路由条目都来自路由器通告的路由</p>
</li>
<li><p>优点：原理简单、易部署，路由过滤及汇总操作灵活</p>
</li>
<li><p>缺点：</p>
<ol>
<li>容易形成环路(因为无法判断收到的路由是不是自己发出去的)</li>
<li>路由收敛慢</li>
</ol>
</li>
</ul>
</li>
<li><p>路径矢量协议</p>
<ul>
<li>目前只有BGP</li>
<li>特点：所有的路由信息中都包含了路径信息(AS-Path)，以自治系统(AS)为节点</li>
<li>通过AS-Path防环</li>
</ul>
</li>
<li><p>链路状态协议(OSPF、IS-IS)</p>
<blockquote>
<p>又称为最短路径优先协议，基于最短路径优先(SPF)算法</p>
</blockquote>
<p>链路状态协议区域内绝对无环</p>
<ul>
<li>优点：路由收敛快、不易出现环路</li>
<li>缺点：对系统性能、带宽要求高，路由控制及过滤不灵活(相比距离矢量协议而言)</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2>IPV6</h2>
<blockquote>
<p>128位地址，分为8块，使用<code>:</code>分隔</p>
<p>例如</p>

<pre><code>2031:0000:130F:0000:0000:09C0:876A:130B
</code></pre>
<p>为了书写方便，每组中的前导“0”都可以省略，所以上述地址可写为：</p>

<pre><code>2031:0:130F:0:0:9C0:876A:130B
</code></pre>
<p>地址中包含的连续两个或多个均为0的组，可以用双冒号“::”来代替，这样可以压缩IPv6地址书写时的长度，所以上述地址又可以进一步简写为：</p>

<pre><code>2031:0:130F::9C0:876A:130B
</code></pre>
<p><strong>在一个IPv6地址中只能使用一次双冒号“::”</strong></p>
</blockquote>
<h3>IPv6地址结构</h3>
<p>一个IPv6地址可以分为如下两部分：</p>
<ul>
<li>网络前缀：n比特，相当于IPv4地址中的网络ID</li>
<li>接口标识：128-n比特，相当于IPv4地址中的主机ID</li>
</ul>
<table>
<thead>
<tr>
  <th style="text-align:center">n bits</th>
  <th>128-n bits</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:center">子网前缀（subnet prefix）</td>
  <td>接口ID（interface ID）</td>
</tr>
</tbody>
</table>
<h3>IPv6的地址分类</h3>
<p>IPv6主要有三种地址：</p>
<h4>单播地址（Unicast）</h4>
<p>唯一标识一个接口</p>
<p>一个单播地址只能标识一个接口，但一个接口可以有多个单播地址</p>
<ul>
<li><p>链路本地地址</p>
<p>只在同一链路上的节点之间有效</p>
<p>固定前缀：FE80::/10</p>
<p>接口ID：使用EUI-64自动生成，也可手动配置</p>
</li>
<li><p>唯一本地地址</p>
<p>可以自己随意使用的私网地址</p>
<p>固定前缀：FC00::/7</p>
</li>
<li><p>全球单播地址</p>
<p>相当于IPv4中的公网地址</p>
<p>已分配的固定前缀：001<br />
地址范围：2000::/3</p>
</li>
</ul>
<blockquote>
<p>配置的全球单播地址不能与该地址对应的网络前缀相同，因为该类型的地址是设备预留的子网路由器任播地址。对于前缀长度是127位的IPv6地址，不受该规则限制。</p>
</blockquote>
<p><strong>IEEE EUI-64格式的接口标识符</strong></p>
<p>IPv6地址中的64位接口标识符（Interface ID）用来标识链路上的唯一接口。这个地址是从接口的链路层地址（如MAC地址）变化而来的。IPv6地址中的接口标识符是64位，而MAC地址是48位，因此需要在MAC地址的中间位置插入十六进制数。然后将U/L位（从高位开始的第7位）设置为“1”，这样就得到了EUI-64格式的接口ID。</p>
<p>以中间位置插入十六进制数FFFE（1111 1111 1111 1110）为例，具体转换过程如下图</p>
<p><figure><a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/archives/assets/30243deb30fdc97d399c19d2088df051.png"><img data-width="501" data-height="241" src="https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/archives/assets/30243deb30fdc97d399c19d2088df051.png" alt="img" /></a><figcaption>img</figcaption></figure></p>
<h4>任播地址（Anycast）</h4>
<p>用来标识一组接口（通常这组接口属于不同的节点）。发送到任播地址的数据包被传输给此地址所标识的一组接口中距离源节点最近的一个接口（最“近”的一个，是指根据路由协议的距离度量）。</p>
<p>具体地址规定：任播地址没有独立的地址空间，它们可使用任何单播地址的格式。因此，需要一种语法来区别任播地址和单播地址。</p>
<p>对于接口标识全为0的IPv6地址，标准协议中定义为子网路由器任播地址（Subnet-Router anycast address）</p>
<blockquote>
<p>任播地址不局限于子网路由器任播地址，全球单播地址也可以配置为任播地址。</p>
</blockquote>
<h4>组播地址（Multicast）</h4>
<p>用来标识属于不同节点的一组接口，类似IPv4的组播地址。发送到组播地址的数据包被传输给此地址所标识的所有接口。</p>
<p>IPv6没有广播地址，广播地址的功能均由组播地址来提供。</p>
<p>下面是一些固定组播地址</p>
<p>所有节点的组播地址：FF02::1  (相当于IPv4中的广播)<br />
所有路由器的组播地址：FF02::2  (相当于224.0.0.2)<br />
所有OSPFV3路由器地址：FF02::5  (相当于224.0.0.5)<br />
所有OSPFV3 DR 和 BDR：FF02::6  (相当于224.0.0.6)<br />
所有RIP路由器：FF02::9  (相当于224.0.0.9)<br />
所有PIM路由器：FF02::D  (相当于224.0.0.13)<br />
被请求节点组播地址：由固定前缀(FF02::1:FFxx:xxxx/104)和单播地址的最后24位组成</p>

<pre><code>例如：IPv6---2001::1234:5678/64
被请求节点组播地址---FF02::1:FF34:5678/104
</code></pre>
</article>
    </section>

    
    <section id="content-pager">
        
            <div class="next">
                <a class="card" href="/wiki/archives/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88%E7%AE%97%E6%B3%95/">
                    <time>March 17 2020</time>
                    <span>最短路径优先算法</span>
                </a>
            </div>
        
        
            <div class="prev">
                <a class="card" href="/wiki/archives/STP%E9%85%8D%E7%BD%AE%E8%BE%B9%E7%BC%98%E7%AB%AF%E5%8F%A3%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/">
                    <time>March 05 2020</time>
                    <span>STP配置边缘端口的两种方式</span>
                </a>
            </div>
        
    </section>
    

    
        <section id="comments">
            <div id="vcomments"></div>
        </section>
        <script>
            window.ValineOpt = {"verify": true, "enable": true, "el": "#vcomments", "notify": true, "visitor": true, "recordIP": true, "placeholder": "\u8bf7\u4e0d\u541d\u8d50\u6559~", "appKey": "izWn3Ac4YE5DLNUzgIOKodoo", "appId": "x0FuLvAqOhV3d8bNU34zT0s4-gzGzoHsz"};
            window.ValineOpt.path = window.location.pathname;
        </script>
    

    <script>
        document.body.classList.add('content');
        document.body.classList.remove('archive');
    </script>
</div>
                    <footer>
                        <span>Copyright © 2020 waleslau</span>
                        
    <span class="leancloud_visitors"
            id="/archives/1_IP%E8%B7%AF%E7%94%B1%E5%9F%BA%E7%A1%80/" 
            data-flag-title="1-IP路由基础">
            <i class="fa fa-eye"></i> <i style="font-style: normal" class="leancloud-visitors-count"></i> Views
        </span>

                        <span class="addon">
<span id="jinrishici-sentence">正在加载今日诗词....</span>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
<!--
<a no-style href="http://www.beian.gov.cn" target="_blank">豫ICP备19025987-2号</a> | 
<a no-style href="https://www.upyun.com" target="_blank">又拍云</a>
-->
</span>
                    </footer>
                </div>
                
<aside id="toc-container" class="no-scrollbar">
    <span><i class="fa fa-align-right"></i> CONTENTS</span>
    <div id="toc"></div>
</aside>

            </div>
        </main>


        <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/tocbot@4.10.0/dist/tocbot.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/assets/kepler-ef161b04d5.js"></script>
        <script>
            function ExSearchCall(item){
                if (item && item.length) {
                    $('.ins-close').click(); // 关闭搜索框
                    $('input.ins-search-input').val(''); // 清空
                    let url = item.attr('data-url'); // 获取目标页面 URL
                    $.pjax({url: url, 
                        container: '#pjax-container',
                        fragment: '#pjax-container',
                        timeout: 8000, }); // 发起一次 PJAX 请求
                }
            }
        </script>

        <!--Valine-->
        
            <script>
                var initValine = function () {
                    if (typeof window.ValineOpt === 'object' && $(window.ValineOpt.el).length) {
                        new Valine(window.ValineOpt);
                    }
                }
            </script>
            <script async src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js' onload="initValine()"></script>
        

        <!--fancybox-->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

        <!--ExSearch-->
        <script src="https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/assets/ExSearch/ExSearch-493cb9cd89.js"></script>
        
        <!--katex-->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/assets/katex.min.css">
        <script defer src="https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/assets/katex.min.js"></script>
        <script>
        mathOpts = {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "\\[", right: "\\]", display: true},
                {left: "$", right: "$", display: false},
                {left: "\\(", right: "\\)", display: false}
            ]
        };
        </script>
        <script defer src="https://cdn.jsdelivr.net/gh/waleslau/wiki@gh-pages/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

        
    </body>
</html>